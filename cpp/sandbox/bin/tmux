#!/bin/bash

app_dir="$(realpath "$(dirname "$0")/../")"
equity_project="alpaca"
equity_symbols=()
forex_project="oanda"
forex_symbols=()

while IFS="" read -r line
  do equity_symbols+=("$line")
done < <(cat "$app_dir/bin/$equity_project/symbols")

while IFS="" read -r line
  do forex_symbols+=("$line")
done < <(cat "$app_dir/bin/$forex_project/symbols")

function tail_cmd() {
  echo -e "tail -f $app_dir/log/$1/$2.log"
}

tmux -2 new-session -s hottspot_capital -n "code" \; \
  send-keys "$app_dir/bin/$equity_project/cron restart" "Enter" \; \
  split-window -h "vim ." \; \
  select-layout main-vertical \; \
  new-window -n "stocks-1" "$(tail_cmd "$equity_project" "${equity_symbols[0]}")" \; \
  split-window -h "$(tail_cmd "$equity_project" "${equity_symbols[1]}")" \; \
  new-window -n "stocks-2" "$(tail_cmd "$equity_project" "${equity_symbols[2]}")" \; \
  split-window -h "$(tail_cmd "$equity_project" "${equity_symbols[3]}")"  \; \
  new-window -n "stock-streams" "$(tail_cmd "$equity_project"  "account_stream")" \; \
  split-window -h "$(tail_cmd "$equity_project" "quote_stream")" \; \
  new-window -n "forex-1" "$(tail_cmd "$forex_project" "${forex_symbols[0]}")" \; \
  split-window -h "$(tail_cmd "$forex_project" "${forex_symbols[1]}")" \; \
  split-window "$(tail_cmd "$forex_project" "${forex_symbols[3]}")" \; \
  select-pane -t 0 \; \
  split-window "$(tail_cmd "$forex_project" "${forex_symbols[2]}")" \; \
  new-window -n "forex-2" "$(tail_cmd "$forex_project" "${forex_symbols[4]}")" \; \
  split-window -h "$(tail_cmd "$forex_project" "${forex_symbols[5]}")" \; \
  split-window "$(tail_cmd "$forex_project" "${forex_symbols[7]}")" \; \
  select-pane -t 0 \; \
  split-window "$(tail_cmd "$forex_project" "${forex_symbols[6]}")" \; \
  new-window -n "forex-streams" "$(tail_cmd "$forex_project" "account_stream")" \; \
  select-window -t 0
