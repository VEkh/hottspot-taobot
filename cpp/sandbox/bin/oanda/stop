#!/bin/bash

fmt_bold="\033[1m"
fmt_cyan="\033[36m"
fmt_green="\033[32m"
fmt_reset="\033[0m"
project_name=$(dirname "$0" | xargs basename)

shopt -s extglob

echo -e "${fmt_bold}"

case $1 in
  +([[:alpha:]_[:alpha:]]))
    symbol="${1^^}"
    state=$(ps aux | rg [t]ao_bot | rg "$project_name" | rg "${symbol,,}")

    if [[ -z $state ]]
    then
      echo -e "${fmt_green}âœ… TaoBot is not running for $symbol"
    else
      echo -e "${fmt_cyan}ðŸ›‘ Stopping TaoBot for $symbol${fmt_reset}"

      ps aux | rg [t]ao_bot | rg "$project_name"  | rg "${symbol,,}" | awk '{print $2}' | xargs kill
    fi

    ;;

  *)
    state=$(ps aux | rg [t]ao_bot | rg "$project_name"  )

    if [[ -z $state ]]
    then
      echo -e "${fmt_green}âœ… No TaoBot instances are running${fmt_reset}"
    else
      echo -e "${fmt_cyan}ðŸ›‘ Stopping all TaoBot instances${fmt_reset}"

      ps aux | rg [t]ao_bot | rg "$project_name"  | awk '{print $2}' | xargs kill
    fi
    ;;
esac
echo

printf "%b" "$fmt_reset"
